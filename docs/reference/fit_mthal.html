<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>MT-HAL: Multi-task Highly Adaptive Lasso — fit_mthal • hal9001</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="MT-HAL: Multi-task Highly Adaptive Lasso — fit_mthal"><meta property="og:description" content="Estimation procedure for MT-HAL, Multi-task Highly Adaptive Lasso"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115145808-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115145808-1');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hal9001</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="https://tlverse.org" class="external-link">tlverse</a>
</li>
<li>
  <a href="../articles/intro_hal9001.html">Overview</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/tlverse/hal9001" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>MT-HAL: Multi-task Highly Adaptive Lasso</h1>
    <small class="dont-index">Source: <a href="https://github.com/tlverse/hal9001/blob/HEAD/R/mthal.R" class="external-link"><code>R/mthal.R</code></a></small>
    <div class="hidden name"><code>fit_mthal.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimation procedure for MT-HAL, Multi-task Highly Adaptive Lasso</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">fit_mthal</span><span class="op">(</span>
  <span class="va">X</span>,
  <span class="va">Y</span>,
  <span class="va">type</span>,
  formula <span class="op">=</span> <span class="cn">NULL</span>,
  max_degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">20</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,
  smoothness_orders <span class="op">=</span> <span class="fl">1</span>,
  num_knots <span class="op">=</span> <span class="fu"><a href="num_knots_generator.html">num_knots_generator</a></span><span class="op">(</span>max_degree <span class="op">=</span> <span class="va">max_degree</span>, smoothness_orders <span class="op">=</span>
    <span class="va">smoothness_orders</span>, base_num_knots_0 <span class="op">=</span> <span class="fl">200</span>, base_num_knots_1 <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,
  reduce_basis <span class="op">=</span> <span class="cn">NULL</span>,
  lambda_1 <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span>,
  nfolds <span class="op">=</span> <span class="fl">10</span>,
  fit_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cv_select <span class="op">=</span> <span class="cn">TRUE</span>, prediction_bounds <span class="op">=</span> <span class="st">"default"</span><span class="op">)</span>,
  basis_list <span class="op">=</span> <span class="cn">NULL</span>,
  return_x_basis <span class="op">=</span> <span class="cn">FALSE</span>,
  yolo <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>X</dt>
<dd><p>A <code>numeric</code> input <code>matrix</code> with dimensions number of
observations -by- number of covariates that will be used to derive the
design matrix of basis functions.</p></dd>
<dt>Y</dt>
<dd><p>A <code>numeric</code> <code>matrix</code> of observations of the outcomes with
dimensions number of observations -by- number of outcomes. Missingness is
permissible in this matrix, i.e., the number of observations can vary
across the tasks. The outcomes can be binary or continuous. The valid
value of binary outcome \(\in \{1, −1\}\).</p></dd>
<dt>type</dt>
<dd><p>The type of problem, a <code>character</code> that must be
<code>"Regression"</code> or <code>"Classification"</code>.</p></dd>
<dt>formula</dt>
<dd><p>A character string formula to be used in
<code><a href="formula_hal.html">formula_hal</a></code>. See its documentation for details.</p></dd>
<dt>max_degree</dt>
<dd><p>The highest order of interaction terms for which basis
functions ought to be generated.</p></dd>
<dt>smoothness_orders</dt>
<dd><p>An <code>integer</code>, specifying the smoothness of the
basis functions. See details for <code>smoothness_orders</code> for more
information.</p></dd>
<dt>num_knots</dt>
<dd><p>An <code>integer</code> vector of length 1 or <code>max_degree</code>,
specifying the maximum number of knot points (i.e., bins) for any covariate
for generating basis functions. If <code>num_knots</code> is a unit-length
vector, then the same <code>num_knots</code> are used for each degree (this is
not recommended). The default settings for <code>num_knots</code> are
recommended, and these defaults decrease <code>num_knots</code> with increasing
<code>max_degree</code> and <code>smoothness_orders</code>, which prevents (expensive)
combinatorial explosions in the number of higher-degree and higher-order
basis functions generated. This allows the complexity of the optimization
problem to grow scalably. See details of <code>num_knots</code> more information.</p></dd>
<dt>reduce_basis</dt>
<dd><p>An optional <code>numeric</code> value bounded in the open
unit interval indicating the minimum proportion of 1's in a basis function
column needed for the basis function to be included in the procedure to fit
the regression. Any basis functions with a lower proportion of 1's than the
cutoff will be removed. Defaults to 1 over the square root of the number of
observations. Only applicable for models fit with zero-order splines, i.e.
<code>smoothness_orders = 0</code>.</p></dd>
<dt>lambda_1</dt>
<dd><p>User-specified sequence of values of the regularization
parameter for the lasso L1 regression, which control cross-task
regularization. If <code>NULL</code>, the default sequence of
<code>10^seq(1, -10, -.1)</code> will be used. The cross-validated
optimal value of this regularization parameter will be selected with
<code><a href="https://rdrr.io/pkg/RMTL/man/cvMTL.html" class="external-link">cvMTL</a></code>. If <code>fit_control</code>'s <code>cv_select</code>
argument is set to <code>FALSE</code>, then (according to the
<code><a href="https://rdrr.io/pkg/RMTL/man/MTL.html" class="external-link">MTL</a></code> documentation) "the <code><a href="https://rdrr.io/pkg/RMTL/man/MTL.html" class="external-link">MTL</a></code> model
will be trained using a warm-start technique".</p></dd>
<dt>nfolds</dt>
<dd><p>Number of V-fold cross-validation folds, default is 10. Only
used when <code>fit_control</code>'s <code>cv_select</code> argument is set to
<code>TRUE</code>.</p></dd>
<dt>fit_control</dt>
<dd><p>List of arguments, including the following, and any
others to be passed to <code><a href="https://rdrr.io/pkg/RMTL/man/cvMTL.html" class="external-link">cvMTL</a></code> or
<code><a href="https://rdrr.io/pkg/RMTL/man/MTL.html" class="external-link">MTL</a></code>.</p><ul><li><p><code>cv_select</code>: A <code>logical</code> specifying if the sequence of
specified <code>lambda_1</code> values should be passed to
<code><a href="https://rdrr.io/pkg/RMTL/man/cvMTL.html" class="external-link">cvMTL</a></code> in order for a single, optimal value of
<code>lambda_1</code> to be selected according to cross-validation. When
<code>cv_select = FALSE</code>, a <code><a href="https://rdrr.io/pkg/RMTL/man/MTL.html" class="external-link">MTL</a></code> model will be
used to fit the sequence of (or single) <code>lambda</code>.</p></li>
<li><p><code>prediction_bounds</code>: An optional list of vectors of size two
that provides the lower and upper bounds on the predictions for each
outcome. When <code>prediction_bounds = "default"</code> and
<code>type = "Regression"</code>, the continuous outcome predictions will be
bounded between <code>min(y) - sd(y)</code> and <code>max(y) + sd(y)</code> for each
outcome <code>y</code>. When <code>type = "Classification"</code>, the probability of
the individual being assigned to positive label P(y==1) is estimated,
and so <code>prediction_bounds</code> are ignored.</p></li>
</ul></dd>
<dt>basis_list</dt>
<dd><p>The full set of basis functions generated from <code>X</code>.</p></dd>
<dt>return_x_basis</dt>
<dd><p>A <code>logical</code> indicating whether or not to return
the matrix of (possibly reduced) basis functions used in <code>fit_hal</code>.</p></dd>
<dt>yolo</dt>
<dd><p>A <code>logical</code> indicating whether to print one of a curated
selection of quotes from the HAL9000 computer, from the critically
acclaimed epic science-fiction film "2001: A Space Odyssey" (1968).</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Object of class <code>mthal9001</code>, containing a list of basis
functions, a copy map, coefficients estimated for basis functions,
timing results (for assessing computational efficiency), and the <code>RMTL</code>fit object.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The procedure uses a custom C++ implementation to generate a design
matrix of spline basis functions of covariates and interactions of
covariates. The regularized multivariate regression is fit to this design
matrix via <span class="pkg">RMTL</span>. The maximum dimension of the design matrix is
\(n\) -by- \((n * 2^(d-1))\), where where \(n\) is the number of
observations and \(d\) is the number of covariates.</p>
<p>For <code>smoothness_orders = 0</code>, only zero-order splines (piece-wise
constant) are generated, which assume the true regression function has no
smoothness or continuity. When <code>smoothness_orders = 1</code>, first-order
splines (piece-wise linear) are generated, which assume continuity of the
true regression function. When <code>smoothness_orders = 2</code>, second-order
splines (piece-wise quadratic and linear terms) are generated, which assume
a the true regression function has a single order of differentiability.</p>
<p><code>num_knots</code> argument specifies the number of knot points for each
covariate and for each <code>max_degree</code>. Fewer knot points can
significantly decrease runtime, but might be overly simplistic. When
considering <code>smoothness_orders = 0</code>, too few knot points (e.g., &lt; 50)
can significantly reduce performance. When <code>smoothness_orders = 1</code> or
higher, then fewer knot points (e.g., 10-30) is actually better for
performance. We recommend specifying <code>num_knots</code> with respect to
<code>smoothness_orders</code>, and as a vector of length <code>max_degree</code> with
values decreasing exponentially. This prevents combinatorial explosions in
the number of higher-degree basis functions generated. The default behavior
of <code>num_knots</code> follows this logic --- for <code>smoothness_orders = 0</code>,
<code>num_knots</code> is set to \(500 / 2^{j-1}\), and for
<code>smoothness_orders = 1</code> or higher, <code>num_knots</code> is set to
\(200 / 2^{j-1}\), where \(j\) is the interaction degree. We also
include some other suitable settings for <code>num_knots</code> below, all of
which are less complex than default <code>num_knots</code> and will thus result
in a faster runtime:</p><ul><li><p>Some good settings for little to no cost in performance:</p><ul><li><p>If <code>smoothness_orders = 0</code> and <code>max_degree = 3</code>,
<code>num_knots = c(400, 200, 100)</code>.</p></li>
<li><p>If <code>smoothness_orders = 1+</code> and <code>max_degree = 3</code>,
<code>num_knots = c(100, 75, 50)</code>.</p></li>
</ul></li>
<li><p>Recommended settings for fairly fast runtime:</p><ul><li><p>If <code>smoothness_orders = 0</code> and <code>max_degree = 3</code>,
<code>num_knots = c(200, 100, 50)</code>.</p></li>
<li><p>If <code>smoothness_orders = 1+</code> and <code>max_degree = 3</code>,
<code>num_knots = c(50, 25, 15)</code>.</p></li>
</ul></li>
<li><p>Recommended settings for fast runtime:</p><ul><li><p>If <code>smoothness_orders = 0</code> and <code>max_degree = 3</code>,
<code>num_knots = c(100, 50, 25)</code>.</p></li>
<li><p>If <code>smoothness_orders = 1+</code> and <code>max_degree = 3</code>,
<code>num_knots = c(40, 15, 10)</code>.</p></li>
</ul></li>
<li><p>Recommended settings for very fast runtime:</p><ul><li><p>If <code>smoothness_orders = 0</code> and <code>max_degree = 3</code>,
<code>num_knots = c(50, 25, 10)</code>.</p></li>
<li><p>If <code>smoothness_orders = 1+</code> and <code>max_degree = 3</code>,
<code>num_knots = c(25, 10, 5)</code>.</p></li>
</ul></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span class="r-in"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">xmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="va">y_prob</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y1</span><span class="op">[</span><span class="va">y1</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span></span>
<span class="r-in"><span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">n</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="va">y_prob</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y2</span><span class="op">[</span><span class="va">y2</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span></span>
<span class="r-in"><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y2</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">mthal_fit</span> <span class="op">&lt;-</span> <span class="fu">fit_mthal</span><span class="op">(</span>X <span class="op">=</span> <span class="va">x</span>, Y <span class="op">=</span> <span class="va">Y</span>, type <span class="op">=</span> <span class="st">"Classification"</span><span class="op">)</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jeremy Coyle, Nima Hejazi, Rachael Phillips, Lars van der Laan, Mark van der Laan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

